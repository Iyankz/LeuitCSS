{% extends "base.html" %}

{% block title %}Server Status{% endblock %}

{% block content %}
<div class="page-header d-flex justify-content-between align-items-center">
    <h1><i class="bi bi-server"></i> Server Status</h1>
    <div class="text-end">
        <small class="text-muted">Last updated: {{ server_time.strftime('%Y-%m-%d %H:%M:%S') }}</small>
    </div>
</div>

<div class="row">
    <!-- Server Information -->
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-pc-display"></i> Server Information
            </div>
            <div class="card-body">
                <table class="table table-sm table-borderless mb-0">
                    <tr>
                        <td class="text-muted" style="width: 40%;">Hostname</td>
                        <td><strong>{{ server_info.hostname }}</strong></td>
                    </tr>
                    <tr>
                        <td class="text-muted">Operating System</td>
                        <td>{{ server_info.os }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">Kernel</td>
                        <td><code>{{ server_info.kernel }}</code></td>
                    </tr>
                    <tr>
                        <td class="text-muted">Server Uptime</td>
                        <td><span id="server-uptime">{{ server_info.uptime }}</span></td>
                    </tr>
                    <tr>
                        <td class="text-muted">Server Time</td>
                        <td>
                            <span id="server-time-display">{{ server_time.strftime('%H:%M:%S') }}</span>
                            <small class="text-muted ms-2">{{ server_time.strftime('%Z') }}</small>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        
        <!-- LeuitCSS Service Status -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-gear"></i> LeuitCSS Service
            </div>
            <div class="card-body">
                <table class="table table-sm table-borderless mb-0">
                    <tr>
                        <td class="text-muted" style="width: 40%;">Status</td>
                        <td>
                            {% if service_info.status == 'running' %}
                            <span class="status-badge status-success">
                                <i class="bi bi-check-circle"></i> Running
                            </span>
                            {% else %}
                            <span class="status-badge status-failed">
                                <i class="bi bi-x-circle"></i> {{ service_info.status|capitalize }}
                            </span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="text-muted">Service Uptime</td>
                        <td>{{ service_info.uptime }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">Started At</td>
                        <td>{{ service_info.started_at or 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">Memory Usage</td>
                        <td>{{ service_info.memory_usage or 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">PID</td>
                        <td><code>{{ service_info.pid or 'N/A' }}</code></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Resource Usage -->
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-cpu"></i> Resource Usage
            </div>
            <div class="card-body">
                <!-- CPU -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-1">
                        <span>CPU Usage</span>
                        <span class="{% if resource_info.cpu_percent > 80 %}text-danger{% elif resource_info.cpu_percent > 60 %}text-warning{% else %}text-success{% endif %}">
                            {{ resource_info.cpu_percent }}%
                        </span>
                    </div>
                    <div class="progress" style="height: 8px; background: var(--bg-main);">
                        <div class="progress-bar {% if resource_info.cpu_percent > 80 %}bg-danger{% elif resource_info.cpu_percent > 60 %}bg-warning{% else %}bg-success{% endif %}" 
                             style="width: {{ resource_info.cpu_percent }}%"></div>
                    </div>
                </div>
                
                <!-- Memory -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Memory Usage</span>
                        <span class="{% if resource_info.memory_percent > 80 %}text-danger{% elif resource_info.memory_percent > 60 %}text-warning{% else %}text-success{% endif %}">
                            {{ resource_info.memory_used }} / {{ resource_info.memory_total }} ({{ resource_info.memory_percent }}%)
                        </span>
                    </div>
                    <div class="progress" style="height: 8px; background: var(--bg-main);">
                        <div class="progress-bar {% if resource_info.memory_percent > 80 %}bg-danger{% elif resource_info.memory_percent > 60 %}bg-warning{% else %}bg-success{% endif %}" 
                             style="width: {{ resource_info.memory_percent }}%"></div>
                    </div>
                </div>
                
                <!-- Disk Total -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Disk Usage (Total)</span>
                        <span class="{% if resource_info.disk_percent > 80 %}text-danger{% elif resource_info.disk_percent > 60 %}text-warning{% else %}text-success{% endif %}">
                            {{ resource_info.disk_used }} / {{ resource_info.disk_total }} ({{ resource_info.disk_percent }}%)
                        </span>
                    </div>
                    <div class="progress" style="height: 8px; background: var(--bg-main);">
                        <div class="progress-bar {% if resource_info.disk_percent > 80 %}bg-danger{% elif resource_info.disk_percent > 60 %}bg-warning{% else %}bg-success{% endif %}" 
                             style="width: {{ resource_info.disk_percent }}%"></div>
                    </div>
                    <small class="text-muted">Free: {{ resource_info.disk_free }}</small>
                </div>
            </div>
        </div>
        
        <!-- Backup Storage -->
        <div class="card">
            <div class="card-header">
                <i class="bi bi-archive"></i> Backup Storage Insight
            </div>
            <div class="card-body">
                <table class="table table-sm table-borderless mb-0">
                    <tr>
                        <td class="text-muted" style="width: 50%;">Storage Path</td>
                        <td><code>{{ backup_storage.path }}</code></td>
                    </tr>
                    <tr>
                        <td class="text-muted">Total Backup Size</td>
                        <td><strong>{{ backup_storage.total_size }}</strong></td>
                    </tr>
                    <tr>
                        <td class="text-muted">Total Backup Files</td>
                        <td><strong>{{ backup_storage.total_files }}</strong></td>
                    </tr>
                    {% if backup_storage.avg_file_size %}
                    <tr>
                        <td class="text-muted">Average File Size</td>
                        <td>{{ backup_storage.avg_file_size }}</td>
                    </tr>
                    {% endif %}
                    <tr>
                        <td class="text-muted">Oldest Backup</td>
                        <td>{{ backup_storage.oldest_backup or 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">Newest Backup</td>
                        <td>{{ backup_storage.newest_backup or 'N/A' }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <small class="text-muted">
        <i class="bi bi-info-circle"></i>
        This page is <strong>read-only</strong>. No actions can be performed from here.
    </small>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Update time display every second
let serverTimeOffset = 0;
const serverTimeStr = '{{ server_time.strftime("%Y-%m-%dT%H:%M:%S") }}';
const pageLoadTime = new Date();
const serverTime = new Date(serverTimeStr);
serverTimeOffset = serverTime.getTime() - pageLoadTime.getTime();

function updateTimeDisplay() {
    const now = new Date();
    const adjustedTime = new Date(now.getTime() + serverTimeOffset);
    const hours = String(adjustedTime.getHours()).padStart(2, '0');
    const mins = String(adjustedTime.getMinutes()).padStart(2, '0');
    const secs = String(adjustedTime.getSeconds()).padStart(2, '0');
    document.getElementById('server-time-display').textContent = `${hours}:${mins}:${secs}`;
}
setInterval(updateTimeDisplay, 1000);
</script>
{% endblock %}
